USE BD_SUPERMERCADO_FUNCIONARIO_PRODUTO_CONSUMIDOR;

INSERT INTO SUPERMERCADO (	SUP_CNPJ, 
							SUP_RAZAO_SOCIAL, 
                            SUP_TELEFONE,
                            SUP_EMAIL,
                            SUP_ENDERECO_LOGRADOURO,
                            SUP_ENDERECO_NUMERO,
                            SUP_ENDERECO_CIDADE,
                            SUP_ENDERECO_ESTADO)
VALUES 					(	"12345678000101",
							"Supermercado Grick",
                            "199999999",
                            "gricktambau@email.com",
                            "Grick Street",
                            "10000",
                            "TambaCity",
                            "SP");

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_ENDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES
("22345678000102", "Supermercado BomPreço", "11988887777", "contato@bompreco.com", "Rua das Laranjeiras", "450", "Campinas", "SP"),
("32345678000103", "Supermercado PagueMenos", "11999995555", "sac@paguemenos.com", "Avenida Brasil", "980", "Piracicaba", "SP"),
("42345678000104", "Supermercado Central", "19987654321", "central@supercentral.com", "Rua XV de Novembro", "120", "Limeira", "SP"),
("52345678000105", "Supermercado Econômico", "19999887766", "atendimento@economico.com", "Av. da Saudade", "75", "Mogi Guaçu", "SP");

INSERT INTO PRODUTO ( 	PRO_CODIGO_BARRAS,
						PRO_NOME,
                        PRO_PESO,
                        PRO_QUANTIDADE,
                        PRO_PRECO,
                        PRO_DATA_VALIDADE)
VALUES				(	"7891234567890",
						"Arroz 5kg",
						5.0,
                        500,
                        26.90,
                        "2025-12-25");

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES
("7894561237891", "Feijão Carioca 1kg", 1.0, 300, 7.49, "2026-02-15"),
("7896543219872", "Açúcar Refinado 2kg", 2.0, 250, 8.29, "2026-04-30"),
("7893216549873", "Óleo de Soja 900ml", 0.9, 400, 6.79, "2026-01-10"),
("7899876543214", "Café Torrado e Moído 500g", 0.5, 150, 12.50, "2026-06-20");

INSERT INTO CONSUMIDOR	(	CON_CPF,
							CON_NOME,
                            CON_TELEFONE,
                            CON_EMAIL)
VALUES					( 	"47486114800",
							"Gabriel Evaristo",
                            "19994154097",
                            "gabriel.santana@sp.senai.br");

INSERT INTO CONSUMIDOR (CON_CPF, CON_NOME, CON_TELEFONE, CON_EMAIL)
VALUES
("12345678901", "Mariana Oliveira", "11988887766", "mariana.oliveira@email.com"),
("98765432100", "Lucas Andrade", "19997776655", "lucas.andrade@email.com"),
("45678912322", "Fernanda Lima", "11999112233", "fernanda.lima@email.com"),
("85236974155", "João Pedro Ramos", "19988223344", "joao.ramos@email.com");

INSERT INTO FUNCIONARIO (	FUN_CPF,
							FUN_NOME,
                            FUN_DATA_NASCIMENTO,
                            FUN_TELEFONE,
                            FUN_EMAIL,
                            FUN_CARTEIRA_TRABALHO,
                            FUN_BANCO_AGENCIA,
                            FUN_BANCO_CONTA,
                            FUN_DATA_ADMISSAO,
                            FUN_JORNADA_TRABALHO,
                            FK_SUP_CNPJ)
VALUES 					( 	"98765432100",
							"José Vanderlei",
                            "1985-03-12",
                            "11987654321",
                            "ze_vanderlei@email.com",
                            "carteira_ze_vanderlei.pdf",
                            "1234",
                            "56789",
                            "2020-01-15",
                            "44 horas",
                            "12345678000101");
                            
INSERT INTO FUNCIONARIO (FUN_CPF, FUN_NOME, FUN_DATA_NASCIMENTO, FUN_TELEFONE, FUN_EMAIL, FUN_CARTEIRA_TRABALHO, FUN_BANCO_AGENCIA, FUN_BANCO_CONTA, FUN_DATA_ADMISSAO, FUN_JORNADA_TRABALHO, FK_SUP_CNPJ)
VALUES
("74125896300", "Ana Paula Souza", "1990-07-22", "11991234567", "ana.paula@email.com", "carteira_ana_paula.pdf", "2356", "99874", "2021-03-10", "40 horas", "22345678000102"),

("85214796311", "Marcos Vinícius Pereira", "1988-11-05", "19993456789", "marcos.vinicius@email.com", "carteira_marcos_vinicius.pdf", "1478", "33221", "2019-08-01", "44 horas", "32345678000103"),

("96325874122", "Carla Mendes", "1995-02-28", "11998887766", "carla.mendes@email.com", "carteira_carla_mendes.pdf", "3254", "11223", "2022-06-20", "36 horas", "42345678000104"),

("35715948633", "Rogério Nascimento", "1982-09-14", "19995554433", "rogerio.nascimento@email.com", "carteira_rogerio_nascimento.pdf", "4567", "88776", "2018-12-05", "44 horas", "52345678000105");

INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES
("12345678000101", 1),  -- Supermercado Grick -> Arroz 5kg
("22345678000102", 2),  -- BomPreço -> Feijão Carioca
("32345678000103", 3),  -- PagueMenos -> Açúcar Refinado
("42345678000104", 4),  -- Central -> Óleo de Soja
("52345678000105", 5);  -- Econômico -> Café Torrado e Moído

INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES
("47486114800", 1),  -- Gabriel Evaristo comprou arroz
("12345678901", 2),  -- Mariana Oliveira comprou feijão
("98765432100", 3),  -- Lucas Andrade comprou açúcar
("45678912322", 4),  -- Fernanda Lima comprou óleo de Soja
("85236974155", 5);  -- João Pedro Ramos comprou café

SELECT * FROM SUPERMERCADO;

/*consultar o aumento de R$2.00 no preço dos produtos com preço atual >= r$5,00*/

SELECT PRO_NOME AS "NOME", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_PRECO AS "PREÇO ATUAL", TRUNCATE((PRO_PRECO + 2),2) AS "PREÇO COM AJUSTE DE R$2,00"
FROM PRODUTO
WHERE PRO_PRECO >= 5;

/*consultar a redução de r$1,00 no preço dos produtos com preço atual abaixo de r$5,00*/

SELECT PRO_NOME AS "NOME", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_PRECO AS "PREÇO ATUAL", TRUNCATE((PRO_PRECO - 1),2) AS "PREÇO COM REDUÇÃO DE R$1,00"
FROM PRODUTO
WHERE PRO_PRECO <=10;

/*CONSULTAR COMO SERIA APLICAR UM DESCONTO DE 10% EM TODOS OS PRODUTOS*/

SELECT PRO_NOME AS "NOME", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_PRECO AS "PREÇO ATUAL", PRO_PRECO-(PRO_PRECO*0.1) AS "PREÇO COM DESCONTO DE 10%"
FROM PRODUTO;

/*AJUSTAR O ESTOQUE DO PRIMEIRO PRODUTO, DIVIDINDO PELA METADE*/

SELECT PRO_ID, PRO_NOME, PRO_CODIGO_BARRAS, PRO_QUANTIDADE
FROM PRODUTO;

UPDATE PRODUTO
SET PRO_QUANTIDADE = PRO_QUANTIDADE/2
WHERE PRO_ID = 1;

/*consultar todos os produtos que tenham data de validade entre setembro de 2025 e dezembro de 2025*/

SELECT PRO_NOME AS "NOME", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_DATA_VALIDADE AS "DATA DE VALIDADE"
FROM PRODUTO
WHERE PRO_DATA_VALIDADE BETWEEN "2025-09-01" AND "2025-12-31";

/*CONSULTAR TODOS OS PRODUTOS QUE TENHAM PREÇO MAIOR QUE 10 OU MENOR QUE 4*/
SELECT PRO_NOME AS "NOME", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_PRECO AS "PREÇO"
FROM PRODUTO
WHERE PRO_PRECO >= 10 OR PRO_PRECO <= 4;

/*CONSULTAR OS DDD'S E TELEFONES DOS CONSUMIDORES SEPARADAMENTE*/
SELECT CON_NOME AS "NOME DO CONSUMIDOR", CON_CPF AS "CPF DO CONSUMIDOR",SUBSTRING(CON_TELEFONE,1,2) AS "DDD DO TELEFONE", SUBSTRING(CON_TELEFONE,3,9) AS "NÚMERO DO TELEFONE"
FROM CONSUMIDOR;

/*GERAR UMA FRase, concatenando: razão social, cnpj, telefone, e email*/
SELECT CONCAT("RAZÃO SOCIAL: ", SUP_RAZAO_SOCIAL, CONCAT(" | CNPJ: ",SUP_CNPJ, CONCAT(" | TELEFONE: ",SUP_TELEFONE, CONCAT(" | EMAIL: ",SUP_EMAIL)))) AS "FRASE"
FROM SUPERMERCADO;

/*GERAR UMA CONSULTA QUE VERIFICA O STATUS DO ESTOQUE DOS PRODUTOS
1) QUANTIDADE <= 25: BAIXO
2) QUANTIDADE > E QUANTIDADE <= 100: ESTOQUE MÉDIO
3) QUANTIDADE > 100: ESTOQUE ALTO*/

SELECT PRO_NOME AS "NOME DO PRODUTO", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_QUANTIDADE AS "QUANTIDADE",
	CASE
		WHEN PRO_QUANTIDADE <= 25 THEN "ESTOQUE BAIXO"
        WHEN PRO_QUANTIDADE > 26 AND PRO_QUANTIDADE < 100 THEN "ESTOQUE MÉDIO"
        WHEN PRO_QUANTIDADE >= 100 THEN "ESTOQUE ALTO"
	END AS "NÍVEL DE ESTOQUE"
FROM PRODUTO;

SELECT PRO_NOME AS "NOME DO PRODUTO", PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", PRO_QUANTIDADE AS "QUANTIDADE", PRO_PESO AS "PESO", PRO_DATA_VALIDADE AS "DATA DE VALIDADE",
	CASE
		WHEN PRO_PESO <= 5 THEN "PESO BAIXO"
        WHEN PRO_PESO > 5 AND PRO_PESO <= 50 THEN "PESO MÉDIO"
        WHEN PRO_PESO > 50 THEN "PESO ALTO"
	END AS "NÍVEL DO PESO"
FROM PRODUTO;

SELECT COUNT(*)
FROM CONSUMIDOR;

SELECT COUNT(*)
FROM SUPERMERCADO;

SELECT COUNT(*)
FROM FUNCIONARIO;

SELECT COUNT(*)
FROM PRODUTO; 

/*SOMAR O PREÇO TOTAL DE TODOS OS PRODUTOS CADASTRADOS*/
SELECT SUM(PRO_PRECO)
FROM PRODUTO;

SELECT CONCAT("R$ ", TRUNCATE(SUM(PRO_PRECO),2)) AS "SOMA TOTAL"
FROM PRODUTO;

/*CALCULAR A MÉDIA DE PREÇOS DOS PRODUTOS*/
SELECT AVG(PRO_PRECO)
FROM (PRODUTO);

SELECT CONCAT("R$ ", TRUNCATE(AVG(PRO_PESO),2)) AS "MÉDIA DE PREÇO"
FROM PRODUTO;

/*PRODUTO MAIS CARO*/
SELECT MAX(PRO_PRECO)
FROM PRODUTO;

/*SELECIONAR O ESTOQUE COM MAIOR QUANTIDADE*/
SELECT MAX(PRO_QUANTIDADE)
FROM PRODUTO;

/*SELECIONAR O PRODUTO MAIS BARATO*/
SELECT MIN(PRO_PRECO)
FROM PRODUTO;

/*MENOR ESTOQUE*/
SELECT MIN(PRO_QUANTIDADE)
FROM PRODUTO;

/*DATA E HORA ATUAL*/
SELECT NOW() FROM DUAL;

SELECT FUN_NOME AS "NOME DO FUNCIONÁRIO", DATE_FORMAT(FUN_DATA_NASCIMENTO, "%D/%M/%Y") AS "DATA DE NASCIMENTO", TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) AS "IDADE"
FROM FUNCIONARIO;

/*MATEMATICA
ABS - VALOR ABSOLUTO DE UM NUMERO
ROUND - ARREDONDAR
POWER - POTÊNCIA*/
SELECT ABS(-10), ROUND(PRO_PRECO) AS "PREÇO ARREDONDADO",POWER(PRO_PRECO,2) AS "PREÇO ELEVADO AO QUADRADO"
FROM PRODUTO;

/*UPPER, LOWER, TRIM*/
SELECT UPPER(FUN_NOME) AS "MAIÚSCULAS", LOWER(FUN_NOME) AS "MINÚSCULAS",TRIM("     Arthur     ")AS "TIRANDO ESPAÇOS"
FROM FUNCIONARIO;


/*GROUP BY (22_10)*/
SELECT PRO_QUANTIDADE,
COUNT(*) AS "REPETIÇÕES"
FROM PRODUTO
GROUP BY PRO_QUANTIDADE;

/*UNION não repete dados, UNION ALL repete*/
/*UNION*/
SELECT FUN_NOME, FUN_CPF
FROM FUNCIONARIO
UNION
SELECT FUN_NOME, FUN_CPF
FROM FUNCIONARIO;

SELECT * FROM PRODUTO;

/*UNION*/
SELECT PRO_NOME
FROM PRODUTO
UNION
SELECT "Arroz 5kg"
FROM DUAL	
UNION 
SELECT "Danone 100ml"
FROM DUAL;

/*UNION ALL*/
SELECT PRO_NOME
FROM PRODUTO
UNION ALL
SELECT "Arroz 5kg"
FROM DUAL	
UNION ALL
SELECT "Danone 100ml"
FROM DUAL;

/*SELECT COM WHERE*/
SELECT FUN_NOME AS "NOME DO FUNCIONÁRIO", FUN_CPF AS "CPF DO FUNCIONÁRIO", FUN_DATA_NASCIMENTO AS "DATA DE NASCIMENTO",
TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) AS "IDADE"
FROM FUNCIONARIO
WHERE TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) >= 25
AND TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) <= 35;

/*RETORNAR SUPERMERCADOS, FUNCIONÁRIOS, CONSUMIDORES COM EMAIL "HOTMAIL" OU "OUTLOOK"*/
SELECT CON_NOME AS "NOME", CON_CPF AS "CPF/CNPJ", CON_TELEFONE AS "TELEFONE", CON_EMAIL AS "EMAIL", "CONSUMIDOR" AS "TIPO"
FROM CONSUMIDOR
WHERE UPPER(CON_EMAIL) LIKE "%EMAIL%"
OR UPPER(CON_EMAIL) LIKE "%OUTLOOK%"
UNION
SELECT FUN_NOME AS "NOME", FUN_CPF AS "CPF/CNPJ", FUN_TELEFONE AS "TELELFONE", FUN_EMAIL AS "EMAIL", "FUNCIONÁRIO" AS "TIPO"
FROM FUNCIONARIO
WHERE UPPER(FUN_EMAIL) LIKE "%EMAIL%"
OR UPPER(FUN_EMAIL) LIKE "%OUTLOOK%"
UNION 
SELECT SUP_RAZAO_SOCIAL AS "NOME", SUP_CNPJ AS "CPF/CNPJ", SUP_TELEFONE AS "TELEFONE", SUP_EMAIL AS "EMAIL", "SUPERMERCADO" AS "TIPO"
FROM SUPERMERCADO
WHERE UPPER(SUP_EMAIL) LIKE "%HOTMAIL%"
OR UPPER(SUP_EMAIL) LIKE "%EMAIL%";

/*ASSOCIAÇÃO DE TABELAS
CROSS JOIN: RETORNAR PRODUTOS E SUPERMERCADOS*/
SELECT PRODUTO.PRO_NOME AS "NOME", PRODUTO.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", SUPERMERCADO.SUP_RAZAO_SOCIAL AS "RAZÃO SOCIAL"
FROM SUPERMERCADO_PRODUTO
CROSS JOIN SUPERMERCADO
CROSS JOIN PRODUTO
WHERE PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID
AND SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ;

/*INNER JOIN:RETORNAR RETORNAR APENAS PRODUTOS COMPRADOS POR ALGUÉM*/
SELECT PRODUTO_CONSUMIDOR.PCO_ID AS "ID DA COMPRA", 
		PRODUTO.PRO_NOME AS "NOME DO PRODUTO", 
        PRODUTO.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
	   CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR", 
       CONSUMIDOR.CON_CPF AS "CPF DO CONSUMIDOR"
FROM PRODUTO_CONSUMIDOR
INNER JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID)
INNER JOIN CONSUMIDOR ON (PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF);

/*RETORNAR FUNCIONÁRIOS QUE TRABALHAM EM ALGUM SUPERMERCADO
NOME DO FUNCIONÁRIO E DO SUPERMERCADO*/
SELECT FUNCIONARIO.FUN_NOME AS "FUNCIONÁRIO", SUPERMERCADO.SUP_RAZAO_SOCIAL AS "SUPERMERCADO"
FROM SUPERMERCADO
INNER JOIN FUNCIONARIO ON (SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*retornar apenas produtos que existam em um supermercado. Nome do produto, nome do supermercado*/
SELECT  PRODUTO.PRO_NOME AS "NOME DO PRODUTO", SUPERMERCADO.SUP_RAZAO_SOCIAL AS "SUPERMERCADO"
FROM SUPERMERCADO_PRODUTO
/*INNER JOIN SUPERMERCADO
INNER JOIN PRODUTO
WHERE PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID
AND SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ;  >>> esse jeito também deu certo por algum motivo*/
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*LEFT JOIN*/
INSERT INTO PRODUTO(PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUE ("33333333", "Chocolate", "30", "1500", 4.50, "2026-01-01");

SELECT PRODUTO.PRO_NOME, SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM PRODUTO
LEFT JOIN SUPERMERCADO_PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
LEFT JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*RIGHT JOIN*/
SELECT * FROM SUPERMERCADO;
/*INSERT INTO `bd_supermercado_funcionario_produto_consumidor`.`SUPERMERCADO` (`SUP_CNPJ`, `SUP_RAZAO_SOCIAL`, `SUP_TELEFONE`, `SUP_EMAIL`, `SUP_ENDERECO_LOGRADOURO`, `SUP_ENDERECO_NUMERO`, `SUP_ENDERECO_CIDADE`, `SUP_ENDERECO_ESTADO`) VALUES ('12345678912345', 'Armazém Geral', '19993864710', 'armazem@hotmail.com', 'Rua Única', '12', 'Valentine', 'NH');
*/

SELECT PRODUTO.PRO_NOME, SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM PRODUTO
RIGHT JOIN SUPERMERCADO_PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
RIGHT JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*EXERCÍCIO*/
SELECT SUPERMERCADO.SUP_RAZAO_SOCIAL, PRODUTO.PRO_NOME
FROM SUPERMERCADO_PRODUTO
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

SELECT FUNCIONARIO.FUN_NOME, SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM SUPERMERCADO
INNER JOIN FUNCIONARIO ON (SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

SELECT CONSUMIDOR.CON_NOME, PRODUTO.PRO_NOME
FROM PRODUTO_CONSUMIDOR
INNER JOIN CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF)
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID);

SELECT CONSUMIDOR.CON_NOME, PRODUTO.PRO_NOME
FROM PRODUTO_CONSUMIDOR
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID)
INNER JOIN CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF);

SELECT SUPERMERCADO.SUP_RAZAO_SOCIAL, COUNT(PRODUTO.PRO_ID) /*CONTAR DEPOIS*/
FROM SUPERMERCADO_PRODUTO
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
GROUP BY SUPERMERCADO.SUP_RAZAO_SOCIAL;


/*======================================================================================================================*/


/*SELECT COM LEFT JOIN E RIGHT JOIN*/
SELECT * 
FROM (
	SELECT S.SUP_RAZAO_SOCIAL AS RAZAO_SOCIAL,
		F.FUN_NOME AS NOME_FUNCIONARIO,
        P.PRO_NOME AS NOME_PRODUTO,
        C.CON_NOME AS NOME_CONSUMIDOR
	FROM SUPERMERCADO S
    LEFT JOIN FUNCIONARIO F ON (S.SUP_CNPJ = F.FK_SUP_CNPJ)
    LEFT JOIN SUPERMERCADO_PRODUTO SP ON (S.SUP_CNPJ = SP.FK_SUP_CNPJ)
    LEFT JOIN PRODUTO P ON (SP.FK_PRO_ID = P.PRO_ID)
    LEFT JOIN PRODUTO_CONSUMIDOR PC ON (P.PRO_ID = PC.FK_PRO_ID)
    LEFT JOIN CONSUMIDOR C ON (PC.FK_CON_CPF = C.CON_CPF)
    UNION
    SELECT S.SUP_RAZAO_SOCIAL AS RAZAO_SOCIAL,
		F.FUN_NOME AS NOME_FUNCIONARIO,
        P.PRO_NOME AS NOME_PRODUTO,
        C.CON_NOME AS NOME_CONSUMIDOR
	FROM SUPERMERCADO S
    RIGHT JOIN FUNCIONARIO F ON (S.SUP_CNPJ = F.FK_SUP_CNPJ)
    RIGHT JOIN SUPERMERCADO_PRODUTO SP ON (S.SUP_CNPJ = SP.FK_SUP_CNPJ)
    RIGHT JOIN PRODUTO P ON (SP.FK_PRO_ID = P.PRO_ID)
    RIGHT JOIN PRODUTO_CONSUMIDOR PC ON (P.PRO_ID = PC.FK_PRO_ID)
    RIGHT JOIN CONSUMIDOR C ON (PC.FK_CON_CPF = C.CON_CPF)
) SELECT_EXTERNO
ORDER BY SELECT_EXTERNO.RAZAO_SOCIAL ASC, SELECT_EXTERNO.NOME_FUNCIONARIO DESC,
		SELECT_EXTERNO.NOME_PRODUTO ASC, SELECT_EXTERNO.NOME_CONSUMIDOR DESC;
        
/*EXERCICIO 2 - LEFT JOIN*/

SELECT SUPERMERCADO.SUP_RAZAO_SOCIAL, PRODUTO.PRO_NOME
FROM SUPERMERCADO
LEFT JOIN SUPERMERCADO_PRODUTO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
LEFT JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID);

SELECT FUNCIONARIO.FUN_NOME, SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM FUNCIONARIO
LEFT JOIN SUPERMERCADO ON (FUNCIONARIO.FK_SUP_CNPJ = SUPERMERCADO.SUP_CNPJ);

SELECT CONSUMIDOR.CON_NOME, PRODUTO.PRO_NOME
FROM CONSUMIDOR
LEFT JOIN PRODUTO_CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF)
LEFT JOIN PRODUTO ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID);

SELECT CONSUMIDOR.CON_NOME, PRODUTO.PRO_NOME
FROM PRODUTO
LEFT JOIN PRODUTO_CONSUMIDOR ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID)
LEFT JOIN CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF);

SELECT SUPERMERCADO.SUP_RAZAO_SOCIAL,FUNCIONARIO.FUN_NOME
FROM SUPERMERCADO
LEFT JOIN FUNCIONARIO ON (SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*EXERCICIOS RIGHT JOIN*/

SELECT PRODUTO.PRO_NOME, SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM SUPERMERCADO
RIGHT JOIN SUPERMERCADO_PRODUTO ON (SUPERMERCADO_PRODUTO.FK_SUP_CNPJ = SUPERMERCADO.SUP_CNPJ)
RIGHT JOIN PRODUTO ON (SUPERMERCADO_PRODUTO.FK_PRO_ID = PRODUTO.PRO_ID); /*IGUAL AO 4º*/

SELECT CONSUMIDOR.CON_NOME, PRODUTO.PRO_NOME
FROM CONSUMIDOR
RIGHT JOIN PRODUTO_CONSUMIDOR ON (PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF)
RIGHT JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID); /*IGUAL AO 5º*/

SELECT FUNCIONARIO.FUN_NOME, SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM FUNCIONARIO
RIGHT JOIN SUPERMERCADO ON (FUNCIONARIO.FK_SUP_CNPJ = SUPERMERCADO.SUP_CNPJ);

/*SELECIONAR APENAS OS PRODUTOS QUE POSSUEM REGISTRO EM UM SUPERMERCADO E QUE FORAM COMPRADOS POR UM CONSUMIDOR*/
SELECT P.PRO_NOME AS "NOME DO PRODUTO", P.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", P.PRO_PRECO AS "PREÇO DO PRODUTO"
FROM PRODUTO P
WHERE P.PRO_ID IN (SELECT SP.FK_PRO_ID FROM SUPERMERCADO_PRODUTO SP)
AND P.PRO_ID  IN (SELECT PC.FK_PRO_ID FROM PRODUTO_CONSUMIDOR PC);

/*SELECIONAR APENAS OS PRODUTOS QUE NÃO POSSUEM REGISTRO EM UM SUPERMERCADO E QUE NÃO FORAM COMPRADOS POR UM CONSUMIDOR*/
SELECT PRODUTO.PRO_NOME, PRODUTO.PRO_CODIGO_BARRAS, PRODUTO.PRO_PRECO
FROM PRODUTO
WHERE PRODUTO.PRO_ID NOT IN (SELECT SP.FK_PRO_ID FROM SUPERMERCADO_PRODUTO SP)
AND PRODUTO.PRO_ID  NOT IN (SELECT PC.FK_PRO_ID FROM PRODUTO_CONSUMIDOR PC);

/*SELECIONAR OS SUPERMERCADOS QUE TENHAM O PREÇO DE TODOS OS PRODUTOS MENOR QUE 10*/
SELECT S.SUP_RAZAO_SOCIAL
FROM SUPERMERCADO S
WHERE 10 > ALL(SELECT P.PRO_PRECO FROM PRODUTO P);

/*LISTAR TODOS OS PRODUTOS CUJO PREÇO SEJA MAIOR QUE O PREÇO DE QUALQUER PRODUTO VENDIDO NO SUPERMERCADO COM CNPJ 12345678000101*/
SELECT PRO_NOME, PRO_PRECO
FROM PRODUTO
WHERE PRO_PRECO  > ANY (
	SELECT P.PRO_PRECO
    FROM PRODUTO P
    INNER JOIN SUPERMERCADO_PRODUTO SP
    ON (P.PRO_ID = SP.FK_PRO_ID)
    WHERE SP.FK_SUP_CNPJ = '12345678000101'
);

/*LISAR TODOS OS CONSUMIDORES QUE COMPRARAM PELO MENOS UM PRODUTO*/
SELECT C.CON_NOME, C.CON_CPF
FROM CONSUMIDOR C 
WHERE EXISTS (
	SELECT 1
    FROM PRODUTO_CONSUMIDOR PC
    WHERE PC.FK_CON_CPF = C.CON_CPF
);
/*LISTAR TODOS OS CONSUMIDORES QUE NÃO COMPRARAM NENHUM PRODUTO*/
SELECT C.CON_NOME, C.CON_CPF
FROM CONSUMIDOR C 
WHERE NOT EXISTS (
	SELECT 1
    FROM PRODUTO_CONSUMIDOR PC
    WHERE PC.FK_CON_CPF = C.CON_CPF
);

/*TCL: LINGUAGEM DE CONTROLE DE TRANSAÇÕES 
COMMIT
PASSO 1 -- INICIAR A TRANSAÇÃO*/
START TRANSACTION;
-- PASSO 2: ESCREVER O COMANDO DML
INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_ENDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ('11111111000111', 'Supermercado Pontes', '11987654321','pontes@pontes.com','Rua do Pontes','100','Tambaú','SP');
-- Passo 3: se tudo deu certo, envia para o banco
COMMIT;

/*ROLLBACK*/
-- PASSO 1 -- INICIAR A TRANSAÇÃO*/
START TRANSACTION;
-- PASSO 2: ESCREVER O COMANDO DML
INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_ENDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ('11111111000111', 'Supermercado Pontes', '11987654321','pontes@pontes.com','Rua do Pontes','100','Tambaú','SP');
-- Passo 3: se tudo deu certo, envia para o banco
ROLLBACK;

/*SAVEPOINTS: SALVAM O ESTADO DO BANCO*/
-- INSERÇÃO SUPERMERCADO
INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_ENDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ('33333333000133', 'Supermercado Nova Era','11987654321','contato@novaera.com.br', 'Rua Nova','150','Porto Alegre','RS');

-- criar um ponto de salvamento (savepoint)
SAVEPOINT savepoint_produto1;

-- inserir o primeiro produto
INSERT INTO PRODUTO(PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ('1234567890987','Açúcar 1kg',1.0,200,3.00,'2025-06-30');

-- segundo salvamento
SAVEPOINT savepoint_produto2;

-- inserir segundo produto com dado inválido (simulação de erro)
INSERT INTO PRODUTO(PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES('9876543210123','Café 500g',0.5,-100,'15.00','2025-09-30'); -- quantidade negativa

-- se algo der errado, voltar ao savepoint anterior
ROLLBACK TO savepoint_produto2;

-- confirmar as mudanças até o primeiro savepoint
COMMIT;